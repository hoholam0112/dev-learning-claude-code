# ì±•í„° 07: ì‚¬ì´ë“œ ì´í™íŠ¸ì™€ ìƒëª…ì£¼ê¸°

> **ë‚œì´ë„**: â­â­ (2/5)
> **ì˜ˆìƒ í•™ìŠµ ì‹œê°„**: 2.5ì‹œê°„
> **ì„ ìˆ˜ ì§€ì‹**: useState, ì´ë²¤íŠ¸ ì²˜ë¦¬ (ì±•í„° 03~06)

---

## í•™ìŠµ ëª©í‘œ

ì´ ì±•í„°ë¥¼ ë§ˆì¹˜ë©´ ë‹¤ìŒì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- ì‚¬ì´ë“œ ì´í™íŠ¸(Side Effect)ê°€ ë¬´ì—‡ì¸ì§€ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤
- `useEffect`ì˜ ì˜ì¡´ì„± ë°°ì—´ì„ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤
- í´ë¦°ì—…(cleanup) í•¨ìˆ˜ì˜ í•„ìš”ì„±ê³¼ ì‚¬ìš©ë²•ì„ ì´í•´í•œë‹¤
- API ë°ì´í„°ë¥¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ê³  í™”ë©´ì— í‘œì‹œí•  ìˆ˜ ìˆë‹¤
- ë¡œë”© ìƒíƒœì™€ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤

---

## í•µì‹¬ ê°œë…

### 1. ì‚¬ì´ë“œ ì´í™íŠ¸(Side Effect)ë€?

React ì»´í¬ë„ŒíŠ¸ì˜ ì£¼ëœ ì—­í• ì€ **JSXë¥¼ ë Œë”ë§**í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ê·¸ ì™¸ì— ì»´í¬ë„ŒíŠ¸ê°€ ìˆ˜í–‰í•˜ëŠ” ëª¨ë“  ì‘ì—…ì„ **ì‚¬ì´ë“œ ì´í™íŠ¸**ë¼ê³  í•©ë‹ˆë‹¤.

ëŒ€í‘œì ì¸ ì‚¬ì´ë“œ ì´í™íŠ¸:
- ì™¸ë¶€ API í˜¸ì¶œ (ë°ì´í„° í˜ì¹­)
- DOM ì§ì ‘ ì¡°ì‘
- íƒ€ì´ë¨¸ ì„¤ì • (`setTimeout`, `setInterval`)
- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡/í•´ì œ
- ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì ‘ê·¼
- êµ¬ë…(subscription) ì„¤ì •/í•´ì œ

```mermaid
graph LR
    A[React ì»´í¬ë„ŒíŠ¸] --> B[ë Œë”ë§<br/>JSX ë°˜í™˜]
    A --> C[ì‚¬ì´ë“œ ì´í™íŠ¸]

    C --> C1[API í˜¸ì¶œ]
    C --> C2[íƒ€ì´ë¨¸]
    C --> C3[ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ]
    C --> C4[ë¡œì»¬ ìŠ¤í† ë¦¬ì§€]
    C --> C5[êµ¬ë…]

    style B fill:#e8f5e9
    style C fill:#fff3e0
```

### 2. useEffect ê¸°ë³¸ êµ¬ì¡°

`useEffect`ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ëœ **ì´í›„ì—** ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.

```jsx
import { useEffect } from 'react';

useEffect(() => {
  // ì´ ì½”ë“œëŠ” ë Œë”ë§ ì´í›„ì— ì‹¤í–‰ë©ë‹ˆë‹¤
  console.log('ì´í™íŠ¸ ì‹¤í–‰!');

  // (ì„ íƒ) í´ë¦°ì—… í•¨ìˆ˜ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
  return () => {
    console.log('ì´í™íŠ¸ ì •ë¦¬(í´ë¦°ì—…)!');
  };
}, [/* ì˜ì¡´ì„± ë°°ì—´ */]);
```

### 3. ì˜ì¡´ì„± ë°°ì—´(Dependency Array)

ì˜ì¡´ì„± ë°°ì—´ì€ ì´í™íŠ¸ê°€ **ì–¸ì œ ë‹¤ì‹œ ì‹¤í–‰ë ì§€**ë¥¼ ê²°ì •í•©ë‹ˆë‹¤. ì´ê²ƒì´ `useEffect`ì˜ ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„ì…ë‹ˆë‹¤.

```mermaid
graph TB
    subgraph A["ì˜ì¡´ì„± ë°°ì—´ ì—†ìŒ"]
        A1["useEffect(() => { ... })"]
        A2["ë§¤ ë Œë”ë§ë§ˆë‹¤ ì‹¤í–‰"]
    end

    subgraph B["ë¹ˆ ë°°ì—´ []"]
        B1["useEffect(() => { ... }, [])"]
        B2["ë§ˆìš´íŠ¸ ì‹œ 1ë²ˆë§Œ ì‹¤í–‰"]
    end

    subgraph C["ì˜ì¡´ì„± ì§€ì • [a, b]"]
        C1["useEffect(() => { ... }, [a, b])"]
        C2["a ë˜ëŠ” bê°€ ë³€ê²½ë  ë•Œ ì‹¤í–‰"]
    end

    style A fill:#ffebee
    style B fill:#e8f5e9
    style C fill:#e3f2fd
```

```jsx
// 1) ì˜ì¡´ì„± ë°°ì—´ ì—†ìŒ -> ë§¤ ë Œë”ë§ë§ˆë‹¤ ì‹¤í–‰ (ì£¼ì˜: ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
useEffect(() => {
  console.log('ë§¤ë²ˆ ì‹¤í–‰ë¨');
});

// 2) ë¹ˆ ë°°ì—´ [] -> ë§ˆìš´íŠ¸ ì‹œ ë”± 1ë²ˆ ì‹¤í–‰
useEffect(() => {
  console.log('ì»´í¬ë„ŒíŠ¸ê°€ ì²˜ìŒ ë‚˜íƒ€ë‚  ë•Œ 1ë²ˆ ì‹¤í–‰');
}, []);

// 3) ì˜ì¡´ì„± ì§€ì • [count] -> countê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ì‹¤í–‰
useEffect(() => {
  console.log(`countê°€ ${count}ë¡œ ë³€ê²½ë¨`);
}, [count]);
```

### 4. í´ë¦°ì—…(Cleanup) í•¨ìˆ˜

ì´í™íŠ¸ê°€ ì„¤ì •í•œ ê²ƒì„ **í•´ì œ(ì •ë¦¬)** í•´ì•¼ í•  ë•Œ í´ë¦°ì—… í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. í´ë¦°ì—…ì€ ë‹¤ìŒ ì´í™íŠ¸ê°€ ì‹¤í–‰ë˜ê¸° ì „ì´ë‚˜ ì»´í¬ë„ŒíŠ¸ê°€ í™”ë©´ì—ì„œ ì‚¬ë¼ì§ˆ ë•Œ(ì–¸ë§ˆìš´íŠ¸) ì‹¤í–‰ë©ë‹ˆë‹¤.

```mermaid
sequenceDiagram
    participant C as ì»´í¬ë„ŒíŠ¸
    participant E as useEffect

    C->>E: ì²« ë Œë”ë§
    E->>E: ì´í™íŠ¸ ì‹¤í–‰ (ì…‹ì—…)

    C->>E: state ë³€ê²½ìœ¼ë¡œ ë¦¬ë Œë”ë§
    E->>E: ì´ì „ í´ë¦°ì—… ì‹¤í–‰
    E->>E: ìƒˆ ì´í™íŠ¸ ì‹¤í–‰ (ì…‹ì—…)

    C->>E: ì–¸ë§ˆìš´íŠ¸
    E->>E: ë§ˆì§€ë§‰ í´ë¦°ì—… ì‹¤í–‰
```

```jsx
// íƒ€ì´ë¨¸ ì˜ˆì‹œ: í´ë¦°ì—…ìœ¼ë¡œ íƒ€ì´ë¨¸ë¥¼ í•´ì œí•´ì•¼ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€
useEffect(() => {
  const timerId = setInterval(() => {
    console.log('1ì´ˆë§ˆë‹¤ ì‹¤í–‰');
  }, 1000);

  // í´ë¦°ì—…: íƒ€ì´ë¨¸ í•´ì œ
  return () => {
    clearInterval(timerId);
  };
}, []);

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì˜ˆì‹œ
useEffect(() => {
  const handleResize = () => {
    console.log('ìœˆë„ìš° í¬ê¸°:', window.innerWidth);
  };

  window.addEventListener('resize', handleResize);

  // í´ë¦°ì—…: ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ í•´ì œ
  return () => {
    window.removeEventListener('resize', handleResize);
  };
}, []);
```

### 5. ë¹„ë™ê¸° ì²˜ë¦¬ì™€ ë°ì´í„° í˜ì¹­

`useEffect`ì˜ ì½œë°± í•¨ìˆ˜ ìì²´ë¥¼ `async`ë¡œ ë§Œë“¤ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤. ëŒ€ì‹  ë‚´ë¶€ì— async í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ê³  í˜¸ì¶œí•˜ëŠ” íŒ¨í„´ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

```jsx
// ì˜ëª»ëœ ë°©ë²• (ì—ëŸ¬ ë°œìƒ)
useEffect(async () => {  // âŒ useEffectëŠ” async í•¨ìˆ˜ë¥¼ ì§ì ‘ ë°›ì„ ìˆ˜ ì—†ìŒ
  const data = await fetch('/api/data');
}, []);

// ì˜¬ë°”ë¥¸ ë°©ë²•
useEffect(() => {
  const fetchData = async () => {
    try {
      const response = await fetch('/api/data');
      const data = await response.json();
      setData(data);
    } catch (error) {
      setError(error.message);
    }
  };

  fetchData();  // async í•¨ìˆ˜ë¥¼ ì •ì˜ í›„ í˜¸ì¶œ
}, []);
```

### 6. ë°ì´í„° í˜ì¹­ íŒ¨í„´: ë¡œë”©/ì—ëŸ¬/ë°ì´í„°

APIë¥¼ í˜¸ì¶œí•  ë•ŒëŠ” ì„¸ ê°€ì§€ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì…ë‹ˆë‹¤:

```mermaid
stateDiagram-v2
    [*] --> ë¡œë”©ì¤‘: ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸
    ë¡œë”©ì¤‘ --> ì„±ê³µ: ë°ì´í„° ìˆ˜ì‹ 
    ë¡œë”©ì¤‘ --> ì—ëŸ¬: ìš”ì²­ ì‹¤íŒ¨
    ì—ëŸ¬ --> ë¡œë”©ì¤‘: ì¬ì‹œë„
    ì„±ê³µ --> ë¡œë”©ì¤‘: ìƒˆë¡œê³ ì¹¨
```

```jsx
function DataFetcher() {
  const [data, setData] = useState(null);     // ë°ì´í„°
  const [loading, setLoading] = useState(true); // ë¡œë”© ìƒíƒœ
  const [error, setError] = useState(null);    // ì—ëŸ¬ ìƒíƒœ

  useEffect(() => {
    const fetchData = async () => {
      try {
        setLoading(true);
        setError(null);
        const response = await fetch('https://api.example.com/data');
        if (!response.ok) throw new Error('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤');
        const result = await response.json();
        setData(result);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, []);

  if (loading) return <p>ë¡œë”© ì¤‘...</p>;
  if (error) return <p>ì—ëŸ¬: {error}</p>;
  return <div>{/* ë°ì´í„° í‘œì‹œ */}</div>;
}
```

---

## ì½”ë“œë¡œ ì´í•´í•˜ê¸°

### ì˜ˆì œ 1: API ë°ì´í„° í˜ì¹­ê³¼ ì‹¤ì‹œê°„ ê²€ìƒ‰
> ğŸ“ `practice/example-01.jsx` íŒŒì¼ì„ ì°¸ê³ í•˜ì„¸ìš”.

```jsx
// í•µì‹¬: ê²€ìƒ‰ì–´ ë³€ê²½ ì‹œ API í˜¸ì¶œ (ë””ë°”ìš´ìŠ¤ ì ìš©)
useEffect(() => {
  const timer = setTimeout(() => {
    fetchUsers(debouncedQuery);
  }, 500);

  return () => clearTimeout(timer);
}, [debouncedQuery]);
```

**ì‹¤í–‰ ë°©ë²•**:
```bash
npx create-react-app effect-demo
cd effect-demo
# src/App.jsì— example-01.jsx ë‚´ìš©ì„ ë³µì‚¬
npm start
```

**ì˜ˆìƒ ì¶œë ¥**: ì‚¬ìš©ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ê³ , ê²€ìƒ‰ ì…ë ¥ì— ë”°ë¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í•„í„°ë§ë©ë‹ˆë‹¤.

### ì˜ˆì œ 2: íƒ€ì´ë¨¸, ìœˆë„ìš° ì´ë²¤íŠ¸, ë¡œì»¬ ìŠ¤í† ë¦¬ì§€
> ğŸ“ `practice/example-02.jsx` íŒŒì¼ì„ ì°¸ê³ í•˜ì„¸ìš”.

```jsx
// í•µì‹¬: ì—¬ëŸ¬ ì¢…ë¥˜ì˜ ì‚¬ì´ë“œ ì´í™íŠ¸ì™€ í´ë¦°ì—…
useEffect(() => {
  const id = setInterval(() => setSeconds(s => s + 1), 1000);
  return () => clearInterval(id);  // í´ë¦°ì—… í•„ìˆ˜!
}, []);
```

**ì‹¤í–‰ ë°©ë²•**:
```bash
# example-01.jsxì™€ ë™ì¼
# src/App.jsì— example-02.jsx ë‚´ìš©ì„ ë³µì‚¬
npm start
```

**ì˜ˆìƒ ì¶œë ¥**: ìŠ¤í†±ì›Œì¹˜, ìœˆë„ìš° í¬ê¸° ì¶”ì ê¸°, ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë©”ëª¨ì¥ì´ í‘œì‹œë©ë‹ˆë‹¤.

---

## ì£¼ì˜ ì‚¬í•­

- âš ï¸ **ë¬´í•œ ë£¨í”„ ì£¼ì˜**: ì´í™íŠ¸ ì•ˆì—ì„œ stateë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ”ë° ì˜ì¡´ì„± ë°°ì—´ì— í•´ë‹¹ stateê°€ í¬í•¨ë˜ë©´ ë¬´í•œ ë£¨í”„ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  ```jsx
  // âŒ ë¬´í•œ ë£¨í”„!
  const [count, setCount] = useState(0);
  useEffect(() => {
    setCount(count + 1);  // countê°€ ë°”ë€Œë©´ ì´í™íŠ¸ ì¬ì‹¤í–‰ -> ë‹¤ì‹œ count ë³€ê²½ -> ...
  }, [count]);
  ```
- âš ï¸ **ê°ì²´/ë°°ì—´ ì˜ì¡´ì„±**: ë§¤ ë Œë”ë§ë§ˆë‹¤ ìƒˆë¡œ ìƒì„±ë˜ëŠ” ê°ì²´/ë°°ì—´ì€ ì˜ì¡´ì„± ë°°ì—´ì— ë„£ìœ¼ë©´ ë§¤ë²ˆ ì´í™íŠ¸ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤. `useMemo`ë‚˜ ì›ì‹œê°’ìœ¼ë¡œ ë³€í™˜í•˜ì„¸ìš”.
- âš ï¸ **async í•¨ìˆ˜**: `useEffect` ì½œë°±ì„ ì§ì ‘ `async`ë¡œ ë§Œë“¤ì§€ ë§ˆì„¸ìš”. ë‚´ë¶€ì—ì„œ async í•¨ìˆ˜ë¥¼ ë”°ë¡œ ì •ì˜í•˜ì„¸ìš”.
- ğŸ’¡ **íŒ**: ì´í™íŠ¸ë¥¼ ì‘ì„±í•  ë•Œ "ì´ ì´í™íŠ¸ê°€ ì •ë¦¬í•´ì•¼ í•  ê²ƒì´ ìˆëŠ”ê°€?"ë¥¼ í•­ìƒ ìë¬¸í•˜ì„¸ìš”.
- ğŸ’¡ **íŒ**: React 18 Strict Modeì—ì„œëŠ” ê°œë°œ ì¤‘ ì´í™íŠ¸ê°€ ë‘ ë²ˆ ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì •ìƒ ë™ì‘ì…ë‹ˆë‹¤.

---

## ì •ë¦¬

| ê°œë… | ì„¤ëª… | ì˜ˆì œ |
|------|------|------|
| useEffect | ë Œë”ë§ ì´í›„ ì‚¬ì´ë“œ ì´í™íŠ¸ ì‹¤í–‰ | `useEffect(() => { ... }, [deps])` |
| ì˜ì¡´ì„± ë°°ì—´ | ì´í™íŠ¸ ì¬ì‹¤í–‰ ì¡°ê±´ ì§€ì • | `[]` = 1íšŒ, `[a]` = a ë³€ê²½ ì‹œ |
| í´ë¦°ì—… í•¨ìˆ˜ | ì´í™íŠ¸ ì •ë¦¬(êµ¬ë…í•´ì œ, íƒ€ì´ë¨¸ í•´ì œ ë“±) | `return () => { clearInterval(id) }` |
| ë°ì´í„° í˜ì¹­ | API í˜¸ì¶œ + ë¡œë”©/ì—ëŸ¬/ë°ì´í„° ìƒíƒœ ê´€ë¦¬ | `fetch().then().catch()` |
| ë””ë°”ìš´ìŠ¤ | ì—°ì†ëœ ì´ë²¤íŠ¸ì—ì„œ ë§ˆì§€ë§‰ ê²ƒë§Œ ì²˜ë¦¬ | `setTimeout` + í´ë¦°ì—…ìœ¼ë¡œ êµ¬í˜„ |

---

## ë‹¤ìŒ ë‹¨ê³„

- âœ… `practice/exercise.md`ì˜ ì—°ìŠµ ë¬¸ì œë¥¼ í’€ì–´ë³´ì„¸ìš”.
- ğŸ“– ë‹¤ìŒ ì±•í„°: **ì±•í„° 08 - Contextì™€ ì „ì—­ ìƒíƒœ** (createContext, useContext, useReducer)
- ğŸ”— ì°¸ê³  ìë£Œ:
  - [React ê³µì‹ ë¬¸ì„œ - useEffect](https://react.dev/reference/react/useEffect)
  - [React ê³µì‹ ë¬¸ì„œ - Synchronizing with Effects](https://react.dev/learn/synchronizing-with-effects)
